<div align="center">

`CÃ´ng ty TNHH Giáº£i PhÃ¡p Ká»¹ Thuáº­t Sá»‘ DH - Máº«u: DH-02: MÃ´ táº£ thay Ä‘á»•i há»‡ thá»‘ng DHG.Hospital 3.1`

</div>
<div align="center">
  <img src="https://raw.githubusercontent.com/dh-hos/dhg.hospitalprinter/main/Deploy_Tools/Logo.ico" alt="Simple Icons" width=70>
  <h1>PHIáº¾U MÃ” Táº¢ THAY Äá»”I Há»† THá»NG</h1>  
</div>
<div align="center">

#### CHá»¦ Äá»€: MÃ” Táº¢ KIá»‚M TRA THá»œI GIAN THá»°C HIá»†N Y Lá»†NH/TRáº¢ Káº¾T QUáº¢ Äá»I Vá»šI CHáº¨N ÄOÃN HÃŒNH áº¢NH/THÄ‚M DÃ’ CHá»¨C NÄ‚NG
</div>

###### :eight_spoked_asterisk: NgÆ°á»i láº­p: [**vinh-dh**](https://github.com/vinh-dh)
###### :eight_spoked_asterisk: NgÃ y láº­p: **30/07/2024**
###### :eight_spoked_asterisk: KhÃ¡ch hÃ ng: **Táº¥t cáº£ khÃ¡ch hÃ ng sá»­ dá»¥ng DHG.Hospital**
###### :eight_spoked_asterisk: YÃªu cáº§u phÃ¡t sinh

- Thá»±c hiá»‡n theo yÃªu cáº§u chi tiáº¿t táº¡i: [MÃ´ táº£ - ThÃªm chá»©c nÄƒng cáº£nh bÃ¡o, cháº·n theo thá»i gian thá»±c hiá»‡n CLS (Chá»‰ Ä‘á»‹nh -> Báº¯t Ä‘áº§u thá»±c hiá»‡n -> Káº¿t quáº£) (#527) â³Dá»± kiáº¿n : 2024-07-31  #528](https://github.com/dh-hos/To_Lap_Trinh/issues/528)
- **LÆ°u Ã½: Chá»‰ Ã¡p dá»¥ng Ä‘á»‘i vá»›i cáº­n lÃ¢m sÃ ng cÃ³ kho thuá»™c HA vÃ  CN.**

###### :eight_spoked_asterisk: Xá»­ lÃ½ yÃªu cáº§u:

:white_check_mark: **Quy trÃ¬nh Ã¡p dá»¥ng:** 

:blue_book: Cáº­p nháº­t cáº¥u trÃºc cho **tham sá»‘**:<br/>
1ï¸âƒ£ Äiá»u chá»‰nh tham sá»‘ **`ha.sophuttoithieu`**:
+ Thay Ä‘á»•i diá»…n giáº£i: Sá»‘ phÃºt tá»‘i thiá»ƒu ká»ƒ tá»« `[thá»i Ä‘iá»ƒm chá»‰ dá»‹nh cáº­n lÃ¢m sÃ ng]` Ä‘áº¿n `[thá»i Ä‘iá»ƒm thá»±c hiá»‡n y lá»‡nh]`. *LÆ°u Ã½: giÃ¡ trá»‹ 0 hoáº·c rá»—ng lÃ  khÃ´ng giá»›i háº¡n.*
+ Pháº¡m vi Ã¡p dá»¥ng: Tá»« thá»i Ä‘iá»ƒm chá»‰ Ä‘á»‹nh Ä‘áº¿n thá»i Ä‘iá»ƒm thá»±c hiá»‡n y lá»‡nh.
 
2ï¸âƒ£ ThÃªm má»›i cÃ¡c tham sá»‘:
| STT | TÃŠN THAM Sá» | KIá»‚U |PHÃ‚N Há»†| DIá»„N GIáº¢I |
|:-------:|-------|:-------:|-------|-------|
|1|ha.sophuttraketqua|Sá»‘|Tham sá»‘ chung|Sá»‘ phÃºt tá»‘i thiá»ƒu ká»ƒ tá»« `[thá»i Ä‘iá»ƒm thá»±c hiá»‡n y lá»‡nh]` Ä‘áº¿n `[thá»i Ä‘iá»ƒm tráº£ káº¿t quáº£]`. LÆ°u Ã½: giÃ¡ trá»‹ 0 hoáº·c rá»—ng lÃ  khÃ´ng giá»›i háº¡n.|

:blue_book: Cáº­p nháº­t cáº¥u trÃºc table **`current.dmloaicls`**: 
| STT | TÃŠN Cá»˜T | KIá»‚U Dá»® LIá»†U |DIá»„N GIáº¢I|
|:-------:|-------|:-------:|-------|
|1|sophutthuchienylenh|NUMERIC(5,0)|Sá»‘ phÃºt tá»‘i thiá»ƒu ká»ƒ tá»« `[thá»i Ä‘iá»ƒm chá»‰ Ä‘á»‹nh]` Ä‘áº¿n `[thá»i Ä‘iá»ƒm thá»±c hiá»‡n y lá»‡nh]` cho cáº­n lÃ¢m sÃ ng thuá»™c loáº¡i nÃ y.|
|2|sophuttraketqua|NUMERIC(5,0)|Sá»‘ phÃºt tá»‘i thiá»ƒu ká»ƒ tá»« [thá»i Ä‘iá»ƒm thá»±c hiá»‡n y lá»‡nh] Ä‘áº¿n [thá»i Ä‘iá»ƒm tráº£ káº¿t quáº£] cho cáº­n lÃ¢m sÃ ng thuá»™c loáº¡i nÃ y.|

:blue_book: Cáº­p nháº­t cáº¥u trÃºc table **`current.dmcls`**: 
| STT | TÃŠN Cá»˜T | KIá»‚U Dá»® LIá»†U |DIá»„N GIáº¢I|
|:-------:|-------|:-------:|-------|
|1|sophutthuchienylenh|NUMERIC(5,0)|Sá»‘ phÃºt tá»‘i thiá»ƒu ká»ƒ tá»« `[thá»i Ä‘iá»ƒm chá»‰ Ä‘á»‹nh]` Ä‘áº¿n `[thá»i Ä‘iá»ƒm thá»±c hiá»‡n y lá»‡nh]` cho cáº­n lÃ¢m sÃ ng nÃ y.|
|2|sophuttraketqua|NUMERIC(5,0)|Sá»‘ phÃºt tá»‘i thiá»ƒu ká»ƒ tá»« [thá»i Ä‘iá»ƒm thá»±c hiá»‡n y lá»‡nh] Ä‘áº¿n [thá»i Ä‘iá»ƒm tráº£ káº¿t quáº£] cho cáº­n lÃ¢m sÃ ng nÃ y.|

:blue_book: Module Admin:
- Táº¡i form **[Danh má»¥c loáº¡i cáº­n lÃ¢m sÃ ng]**: bá»• sung thÃªm cá»™t trÃªn lÆ°á»›i vÃ  Control cÃ³: <br/>
â¡ï¸ NhÃ£n `[Sá»‘ phÃºt thá»±c hiá»‡n y lá»‡nh]`, tÆ°Æ¡ng á»©ng vá»›i dá»¯ liá»‡u cá»™t `dmloaicls.sophutthuchienylenh`.<br/>
â¡ï¸ NhÃ£n `[Sá»‘ phÃºt tráº£ káº¿t quáº£]`, tÆ°Æ¡ng á»©ng vá»›i dá»¯ liá»‡u cá»™t `dmloaicls.sophuttraketqua`.
- Táº¡i form **[Danh má»¥c cáº­n lÃ¢m sÃ ng]**: bá»• sung thÃªm *(cÃ³ thá»ƒ táº¡o TAB má»›i Ä‘á»ƒ cáº­p nháº­t cÃ¡c thÃ´ng tin nÃ y)* cá»™t trÃªn lÆ°á»›i vÃ  Control cÃ³: <br/>
â¡ï¸ NhÃ£n `[Sá»‘ phÃºt thá»±c hiá»‡n y lá»‡nh]`, tÆ°Æ¡ng á»©ng vá»›i dá»¯ liá»‡u cá»™t `dmcls.sophutthuchienylenh`.<br/>
â¡ï¸ NhÃ£n `[Sá»‘ phÃºt tráº£ káº¿t quáº£]`, tÆ°Æ¡ng á»©ng vá»›i dá»¯ liá»‡u cá»™t `dmcls.sophuttraketqua`.
 
:blue_book: Module Diagnose: Táº¡i cÃ¡c form thá»±c hiá»‡n tráº£ káº¿t quáº£, thá»±c hiá»‡n kiá»ƒm tra `[thá»i gian thá»±c hiá»‡n y lá»‡nh]` vÃ  `[thá»i gian tráº£ káº¿t quáº£]` (trÆ°á»›c khi lÆ°u) tuáº§n tá»± nhÆ° sau:<br/>
1ï¸âƒ£ Kiá»ƒm tra thá»i gian thá»±c hiá»‡n y lá»‡nh:
- `sophutthuchienylenh` = (Æ°u tiÃªn láº¥y tuáº§n tá»± náº¿u khÃ¡c 0 theo trÃ¬nh tá»±: `dmcls.sophutthuchienylenh â‡’  dmloaicls.sophutthuchienylenh â‡’ [tham sá»‘ ha.sophuttoithieu]`). 
- Náº¿u `sophutthuchienylenh > 0`, kiá»ƒm tra **`[chidinhcls.ngaykcb + sophutthuchienylenh] > [NgÃ y thá»±c hiá»‡n y lá»‡nh Ä‘Ã£ chá»n trÃªn form]`** â‡’ ğŸš«KHÃ”NG thá»±c hiá»‡n lÆ°u káº¿t quáº£.

2ï¸âƒ£ Kiá»ƒm tra thá»i gian tráº£ káº¿t quáº£:
- `sophuttraketqua` = (Æ°u tiÃªn láº¥y tuáº§n tá»± náº¿u khÃ¡c 0 theo trÃ¬nh tá»±: `dmcls.sophuttraketqua â‡’  dmloaicls.sophuttraketqua â‡’ [tham sá»‘ ha.sophuttraketqua]`).
- Náº¿u `sophuttraketqua> 0`, kiá»ƒm tra **`[NgÃ y thá»±c hiá»‡n y lá»‡nh Ä‘Ã£ chá»n trÃªn form] + sophuttraketqua > [NgÃ y káº¿t quáº£ Ä‘Ã£ chá»n trÃªn form]`** â‡’ ğŸš«KHÃ”NG thá»±c hiá»‡n lÆ°u káº¿t quáº£.

â˜‘ï¸ Bá»• sung quy trÃ¬nh kiá»ƒm tra `[Sá»‘ phÃºt tá»‘i thiá»ƒu Ä‘á»ƒ tráº£ káº¿t quáº£ tá»« láº§n tráº£ káº¿t quáº£ gáº§n nháº¥t cá»§a má»™t tÃ i khoáº£n]` *(Ä‘Ã£ Ã¡p dá»¥ng)*:
- Tham sá»‘ `ha.sophut_thuchien_toithieu`.
- Diá»…n giáº£i: `Sá»‘ phÃºt tá»‘i thiá»ƒu Ä‘á»ƒ tráº£ káº¿t quáº£ tá»« láº§n tráº£ káº¿t quáº£ gáº§n nháº¥t cá»§a má»™t tÃ i khoáº£n (giÃ¡ trá»‹ rá»—ng hoáº·c 0: khÃ´ng Ã¡p dá»¥ng).`
- Quy trÃ¬nh Ã¡p dá»¥ng *(khi giÃ¡ trá»‹ tham sá»‘ `ha.sophut_thuchien_toithieu > 0`)*:<br/>
â‡’ Láº¥y thÃ´ng tin thá»i gian Ä‘Ã£ tráº£ káº¿t quáº£ má»›i nháº¥t trÆ°á»›c Ä‘Ã³ cá»§a bÃ¡c sÄ© Ä‘á»c káº¿t quáº£ (lÆ°u trá»¯ táº¡i table `pskhamha.ngaycd` láº¥y theo Ä‘iá»u kiá»‡n `pskhamha.manv`, tÆ°Æ¡ng á»©ng vá»›i bÃ¡c sÄ© Ä‘ang Ä‘á»c káº¿t quáº£) `(náº¿u cÃ³)` `[1]`.<br/>
â‡’ Náº¿u `pskhamha.ngaycd` táº¡i `[1]` tá»“n táº¡i: Kiá»ƒm tra  **`pskhamha.ngaycd + ha.sophut_thuchien_toithieu > [NgÃ y káº¿t quáº£ Ä‘Ã£ chá»n trÃªn form]`** â‡’ ğŸš«KHÃ”NG thá»±c hiá»‡n lÆ°u káº¿t quáº£.
